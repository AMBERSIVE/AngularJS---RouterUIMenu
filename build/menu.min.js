!function(a,b,c){"use strict";angular.module("ambersive.routerui.menu",["ui.router","ambersive.routerui.auth"]),angular.module("ambersive.routerui.menu").provider("$routerMenuSettings",[function(){var a={template:"src/views/router.ui.menu.default.html",templateInline:"src/views/router.ui.menu.inline.html"};return{setValue:function(b,d){a[b]!==c&&(a[b]=d)},$get:function(){return{all:a,template:a.template,templateInline:a.templateInline}}}}]),angular.module("ambersive.routerui.menu").config(["$urlRouterProvider",function(a){}]),angular.module("ambersive.routerui.menu").run(["$rootScope","$state","$log","RouterUiMenuSrv",function(a,b,c,d){var e=b.get(),f=e.length,g=0;e.forEach(function(a,b){g++,angular.isDefined(a.menu)&&angular.isDefined(a.menu.label)&&d.registerState(a),f===g&&d.sortGroups()})}]),angular.module("ambersive.routerui.menu").factory("RouterUiMenuSrv",["$q","$log","$state","$rootScope",function(a,b,d,e){var f={},g=function(){return{name:"",icon:"",label:"",sort:0,hiddenAt:[],visibleAt:[],children:[]}},h={},i=function(a,b){return a.sort<b.sort?-1:a.sort>b.sort?1:0},j={},k=[],l={};return e.$on("$stateAuthenticationUser",function(a,b){l=b.user}),f.findByParent=function(a){var b=-1;if(a===c)return b;var d=f.getGroupNameForState(a);if(d!==c)for(var e=j[d].children,g=e.length,h=0;g>h;h++)e[h].name!==a||(b=h);return b},f.getStatesByParent=function(a,b){var e=d.get();return b===c&&(b=!0),e=e.filter(function(b){return b.parent!==c&&b.parent===a?b:void 0}),b===!0&&(e=e.sort(i)),e},f.getGroupNameForState=function(a){var b=d.get(a);return b.menu!==c&&b.menu.group!==c?b.menu.group:c},f.registerState=function(a){if(a===c)return void b.warn("ambersive.routerui.menu: error while register state. missing state object.");a.menu.group!==c&&j[a.menu.group]===c&&(j[a.menu.group]={sort:0,children:[]});var e=new g,f=1,h=function(a,b,e){e++;var f=[],i=d.get().filter(function(b){return b.parent===a?b:void 0});return i.forEach(function(a,d){var i=new g;i.name=a.name,i.label=a.menu.label,i.icon=a.menu.icon,i.sort=a.menu.sort,i.hiddenAt=a.menu.hiddenAt,i.visibleAt=a.menu.visibleAt,i.level=e,i.data=a.data||{},i.hiddenAt===c&&(i.hiddenAt=[]),i.visibleAt===c&&(i.visibleAt=[]),b.hiddenAt===c&&(b.hiddenAt=[]),b.hiddenAt!==c&&(i.hiddenAt=i.hiddenAt.concat(b.hiddenAt)),b.visibleAt!==c&&(i.visibleAt=i.visibleAt.concat(b.visibleAt)),i.children=h(i.name,i,e),f.push(i)}),f};return e.name=a.name,e.label=a.menu.label,e.icon=a.menu.icon,e.sort=a.menu.sort,e.hiddenAt=a.menu.hiddenAt,e.visibleAt=a.menu.visibleAt,e.level=f,e.data=a.data||{},a.menu.group!==c&&(e.children=h(a.name,e,f),j[a.menu.group].children.push(e)),j[a.menu.group]},f.check=function(a,b){if(l.roles===c)return a;var e=this,f=function(a){var b=!1,g=!0,h=d.get(a.name),i=function(a){var b=!1;return l.roles!==c&&l.roles.indexOf(a)>-1&&(b=!0),b},j=function(a){var b=!1,e=d.current.name;if(a!==c)return e.indexOf(a)>-1&&(b=!0),b},k=!1,m=!1;if(a.children!==c&&a.children.length>0?a.children=a.children.filter(f):h.data!==c&&h.data.roles!==c&&(g=0===h.data.roles.length?!0:h.data.roles.some(i)),!(e.maxLevel!==c&&e.maxLevel<a.level)&&b!==!0&&g!==!1){if(a.visibleAt!==c&&angular.isArray(a.visibleAt)&&(m=a.visibleAt.some(j),m===!0))return a;if(a.hiddenAt===c||!angular.isArray(a.hiddenAt)||(k=a.hiddenAt.some(j),k!==!0))return a}};return a.children!==c&&a.children.length>0?(a.children=a.children.filter(f),a):a},f.sortGroups=function(){k=[];for(var a in j)j[a].name=a,j[a].label=f.getGroupLabel(a),j[a].children.sort(i),k.push(j[a]);return k},f.getGroup=function(a){return a===c?j:j[a]},f.getSortedGroup=function(){return k},f.setGroupLabel=function(a,b){return h[a]=b,h[a]},f.getGroupLabel=function(a){return h[a]!==c?h[a]:a},f}]),angular.module("ambersive.routerui.menu").directive("routerUiMenuGroups",["$compile","RouterUiMenuSrv",function(a,b){var d={};return d.restrict="E",d.scope={group:"@",template:"@",levels:"@?"},d.replace=!0,d.transclude=!0,d.controller=["$compile","$scope","$state","$element","$log","$timeout","$templateCache","$http","RouterUiMenuSrv","$routerMenuSettings","Auth",function(a,b,d,e,f,g,h,i,j,k,l){var m=this,n={};b.data=[],b.getTemplateByUrl=!1,b.group!==c&&(m.group=b.group),b.template!==c?m.templateUrl=b.template:m.templateUrl=k.template,b.$on("$stateAuthenticationUser",function(a,c){n=c.user,m.getData(),g(function(){b.$apply()},100)}),b.$on("$stateChangeSuccess",function(a,b,c,d,e){m.getData()}),b.warn=function(a){f.warn(a)},m.getData=function(){if(n.roles!==c){var a=[];a=m.group!==c?[j.getGroup(m.group)]:j.getSortedGroup();var d=angular.copy(a),e={};b.levels!==c&&(e.maxLevel=parseInt(b.levels)),b.data=d.filter(j.check,e)}},m.init=function(){var d=null;d=h.get(m.templateUrl),d===c&&(b.getTemplateByUrl=!0,i.get(m.templateUrl,{}).then(function(c){200===c.status?(d=c.data,e.html(d),e.replaceWith(a(e.html())(b))):b.warn("ambersive.routerui.menu: $http loading template failed")},function(){b.warn("ambersive.routerui.menu: $http loading template failed")})),b.templateHtml=d,l.callAPI().then(function(){m.getData()})},m.init()}],d.link=function(b,d,e){try{if(b.getTemplateByUrl===!0)return;if(b.templateHtml===c)return void b.warn("ambersive.routerui.menu: template is undefined");d.html(b.templateHtml),d.replaceWith(a(d.html())(b))}catch(f){b.warn(f)}},d}]),angular.module("ambersive.routerui.menu").directive("routerUiMenu",["$compile","RouterUiMenuSrv",function(a,b){var d={};return d.restrict="E",d.scope={parent:"@",template:"@"},d.replace=!0,d.transclude=!0,d.controller=["$compile","$scope","$state","$element","$log","$timeout","$templateCache","$http","RouterUiMenuSrv","$routerMenuSettings","Auth",function(a,b,d,e,f,g,h,i,j,k,l){var m=this,n={};b.data=[],b.getTemplateByUrl=!1,b.group!==c&&(m.group=b.group),b.template!==c?m.templateUrl=b.template:m.templateUrl=k.templateInline,b.$on("$stateAuthenticationUser",function(a,c){n=c.user,m.getData(),g(function(){b.$apply()},100)}),b.$on("$stateChangeSuccess",function(a,b,c,d,e){m.getData()}),b.warn=function(a){f.warn(a)},m.getData=function(){var a;if(n.roles!==c){a=b.parent===c?d.current.name:b.parent;var e=j.getStatesByParent(a),f=angular.copy(e),g={};b.data=f.filter(j.check,g)}},m.init=function(){var d=null;if(d=h.get(m.templateUrl),d===c){if(b.getTemplateByUrl=!0,m.templateUrl===c)return void b.warn("ambersive.routerui.menu: $http loading template missing.");i.get(m.templateUrl,{}).then(function(c){200===c.status?(d=c.data,e.html(d),e.replaceWith(a(e.html())(b))):b.warn("ambersive.routerui.menu: $http loading template failed")},function(){b.warn("ambersive.routerui.menu: $http loading template failed")})}b.templateHtml=d,l.callAPI().then(function(){m.getData()})},m.init()}],d.link=function(b,d,e){try{if(b.getTemplateByUrl===!0)return;if(b.templateHtml===c)return void b.warn("ambersive.routerui.menu: template is undefined");d.html(b.templateHtml),d.replaceWith(a(d.html())(b))}catch(f){b.warn(f)}},d}])}(window,document,void 0),angular.module("ambersive.routerui.menu").run(["$templateCache",function(a){"use strict";a.put("src/views/router.ui.menu.default.html",'<script type=text/ng-template id=navElementDefault.html><a ui-sref="{{child.name}}" ><i ng-if="child.icon !== undefined && child.icon !== \'\'" class="{{child.icon}}"></i> {{child.label}}</a>\n    <ul ng-if="child.children.length" class="level_{{child.level}}">\n        <li ng-repeat="child in child.children" ng-include="\'navElementDefault.html\'" ui-sref-active="active"></li>\n    </ul></script><div class=navigation><ul class="nav nav-pills nav-stacked"><li ng-repeat="nav in data"><ul class="nav level_0"><li ng-repeat="child in nav.children" ng-include="\'navElementDefault.html\'" ui-sref-active=active></li></ul></li></ul></div>'),a.put("src/views/router.ui.menu.inline.html",'<script type=text/ng-template id=navElementInline.html><a ui-sref="{{element.name}}" class="nav-link"><i ng-if="nav.icon !== undefined && nav.icon !== \'\'" class="{{nav.icon}}"></i> <span ng-if="element.menu === undefined || element.menu.label === undefined">{{element.label}}</span><span ng-if="element.menu !== undefined && element.menu.label !== undefined">{{element.menu.label}}</span></a></script><div class=navigation><ul class="nav nav-tabs"><li ng-repeat="element in data" ng-include="\'navElementInline.html\'" class=nav-item ui-sref-active=active></li></ul></div>')}]);