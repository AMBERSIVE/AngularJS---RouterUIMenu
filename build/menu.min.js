!function(a,b,c){"use strict";angular.module("ambersive.routerui.menu",["ui.router","ambersive.routerui.auth"]),angular.module("ambersive.routerui.menu").provider("$routerMenuSettings",[function(){var a={template:"src/views/router.ui.menu.default.html"};return{setValue:function(b,d){a[b]!==c&&(a[b]=d)},$get:function(){return{all:a,template:a.template}}}}]),angular.module("ambersive.routerui.menu").config(["$urlRouterProvider",function(a){}]),angular.module("ambersive.routerui.menu").run(["$rootScope","$state","$log","RouterUiMenuSrv",function(a,b,d,e){var f=b.get(),g=f.length,h=0;f.forEach(function(a,b){h++,a.menu!==c&&e.registerState(a),g===h&&e.sortGroups()})}]),angular.module("ambersive.routerui.menu").factory("RouterUiMenuSrv",["$q","$log","$state","$rootScope",function(a,b,d,e){var f={},g=function(){return{name:"",label:"",sort:0,hiddenAt:[],visibleAt:[],children:[]}},h={},i=function(a,b){return a.sort<b.sort?-1:a.sort>b.sort?1:0},j={},k=[],l={};return e.$on("$stateAuthenticationUser",function(a,b){l=b.user}),f.findByParent=function(a){var b=-1;if(a===c)return b;var d=f.getGroupNameForState(a);if(d!==c)for(var e=j[d].children,g=e.length,h=0;g>h;h++)e[h].name!==a||(b=h);return b},f.getGroupNameForState=function(a){var b=d.get(a);return b.menu!==c&&b.menu.group!==c?b.menu.group:c},f.registerState=function(a){if(a===c)return void b.warn("ambersive.routerui.menu: error while register state. missing state object.");a.menu.group!==c&&j[a.menu.group]===c&&(j[a.menu.group]={sort:0,children:[]});var e=new g,f=function(a,b){var e=[],h=d.get().filter(function(b){return b.parent===a?b:void 0});return h.forEach(function(a,d){var h=new g;h.name=a.name,h.label=a.menu.label,h.sort=a.menu.sort,h.hiddenAt=a.menu.hiddenAt,h.visibleAt=a.menu.visibleAt,h.hiddenAt===c&&(h.hiddenAt=[]),h.visibleAt===c&&(h.visibleAt=[]),b.hiddenAt===c&&(b.hiddenAt=[]),h.hiddenAt=h.hiddenAt.concat(b.hiddenAt),h.visibleAt=h.visibleAt.concat(b.visibleAt),h.children=f(h.name,h),e.push(h)}),e};return e.name=a.name,e.label=a.menu.label,e.sort=a.menu.sort,e.hiddenAt=a.menu.hiddenAt,e.visibleAt=a.menu.visibleAt,a.menu.group!==c&&(e.children=f(a.name,e),j[a.menu.group].children.push(e)),j[a.menu.group]},f.check=function(a){if(l.roles===c)return a;var b=function(a){var e=!1,f=!0,g=d.get(a.name),h=function(a){var b=!1;return l.roles!==c&&l.roles.indexOf(a)>-1&&(b=!0),b},i=function(a){var b=!1,c=d.current.name;return c.indexOf(a)>-1&&(b=!0),b},j=!1,k=!1;if(a.children!==c&&a.children.length>0?a.children=a.children.filter(b):g.data!==c&&g.data.roles!==c&&(f=0===g.data.roles.length?!0:g.data.roles.some(h)),e!==!0&&f!==!1){if(a.visibleAt!==c&&angular.isArray(a.visibleAt)&&(k=a.visibleAt.some(i),k===!0))return a;if(a.hiddenAt===c||!angular.isArray(a.hiddenAt)||(j=a.hiddenAt.some(i),j!==!0))return a}};return a.children!==c&&a.children.length>0?(a.children=a.children.filter(b),a):a},f.sortGroups=function(){k=[];for(var a in j)j[a].name=a,j[a].label=f.getGroupLabel(a),j[a].children.sort(i),k.push(j[a]);return k},f.getGroup=function(a){return a===c?j:j[a]},f.getSortedGroup=function(){return k},f.setGroupLabel=function(a,b){return h[a]=b,h[a]},f.getGroupLabel=function(a){return h[a]!==c?h[a]:a},f}]),angular.module("ambersive.routerui.menu").directive("routerUiMenuGroups",["$compile","RouterUiMenuSrv",function(a,b){var d={};return d.restrict="E",d.scope={group:"@",template:"@"},d.replace=!0,d.transclude=!0,d.controller=["$compile","$scope","$state","$element","$log","$timeout","$templateCache","$http","RouterUiMenuSrv","$routerMenuSettings","Auth",function(a,b,d,e,f,g,h,i,j,k,l){var m=this,n={};b.data=[],b.getTemplateByUrl=!1,b.group!==c&&(m.group=b.group),b.template!==c?m.templateUrl=b.template:m.templateUrl=k.template,b.$on("$stateAuthenticationUser",function(a,c){n=c.user,m.getData(),g(function(){b.$apply()},100)}),b.$on("$stateChangeSuccess",function(a,b,c,d,e){m.getData()}),b.warn=function(a){f.warn(a)},m.getData=function(){if(n.roles!==c){var a=[];a=m.group!==c?[j.getGroup(m.group)]:j.getSortedGroup();var d=angular.copy(a);b.data=d.filter(j.check)}},m.init=function(){var d=null;d=h.get(m.templateUrl),d===c&&(b.getTemplateByUrl=!0,i.get(m.templateUrl,{}).then(function(c){200===c.status?(d=c.data,e.html(d),e.replaceWith(a(e.html())(b))):b.warn("ambersive.routerui.menu: $http loading template failed")},function(){b.warn("ambersive.routerui.menu: $http loading template failed")})),b.templateHtml=d,m.getData()},m.init()}],d.link=function(b,d,e){try{if(b.getTemplateByUrl===!0)return;if(b.templateHtml===c)return void b.warn("ambersive.routerui.menu: template is undefined");d.html(b.templateHtml),d.replaceWith(a(d.html())(b))}catch(f){b.warn(f)}},d}])}(window,document,void 0),angular.module("ambersive.routerui.menu").run(["$templateCache",function(a){"use strict";a.put("src/views/router.ui.menu.default.html",'<script type=text/ng-template id=navElement.html><a ui-sref="{{child.name}}" >{{child.label}}</a>\n    <ul ng-if="child.children.length">\n        <li ng-repeat="child in child.children" ng-include="\'navElement.html\'" ui-sref-active="active"></li>\n    </ul></script><div class=navigation><ul class="nav nav-pills nav-stacked"><li ng-repeat="nav in data"><ul class=nav><li ng-repeat="child in nav.children" ng-include="\'navElement.html\'" ui-sref-active=active></li></ul></li></ul></div>')}]);